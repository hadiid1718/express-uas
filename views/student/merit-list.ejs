<%- include('../partials/header', {isAdmin: true}) %>

<div class="dashboard-header">
  <div class="container">
    <h1 class="dashboard-title">Published Merit List</h1>
    <p class="dashboard-subtitle">View selection results</p>
  </div>
</div>

<section style="padding: 4rem 0;">
  <div class="container">
    <% if (error && error.length > 0) { %>
      <div class="alert alert-error"><%= error %></div>
    <% } %>
    
    <% if (success && success.length > 0) { %>
      <div class="alert alert-success"><%= success %></div>
    <% } %>
    
    <% 
      let selectedCount = applications.filter(app => app.status === 'Selected').length;
      let rejectedCount = applications.filter(app => app.status === 'Not Selected').length;
      let pendingCount = applications.filter(app => app.status === 'Pending').length;
    %>
    
    <div class="stats-grid">
      <div class="stat-card" style="border-left-color: var(--lime-green);">
        <div class="stat-number"><%= selectedCount %></div>
        <div class="stat-label">Selected</div>
      </div>
      
      <div class="stat-card" style="border-left-color: var(--pink);">
        <div class="stat-number"><%= rejectedCount %></div>
        <div class="stat-label">Not Selected</div>
      </div>
      
      <div class="stat-card" style="border-left-color: var(--orange);">
        <div class="stat-number"><%= pendingCount %></div>
        <div class="stat-label">Pending</div>
      </div>
    </div>
    
    <% if (applications.length > 0) { %>
      <div class="table-container" style="margin-top: 3rem;">
        <h2 style="margin-bottom: 1.5rem; color: var(--dark-violet);">
          Complete Merit List
        </h2>
        <table>
          <thead>
            <tr>
              <th>Position</th>
              <th>Name</th>
              <th>Email</th>
              <th>CNIC</th>
              <th>Program</th>
              <th>Merit Score</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <% applications.forEach((app, index) => { %>
              <tr style="<%= app.status === 'Selected' ? 'background-color: #d4edda;' : app.status === 'Not Selected' ? 'background-color: #f8d7da;' : '' %>">
                <td style="font-weight: 600;"><%= index + 1 %></td>
                <td><%= app.student.name %></td>
                <td><%= app.student.email %></td>
                <td><%= app.student.cnic %></td>
                <td><%= app.program %></td>
                <td style="font-weight: 600; color: var(--color-primary);"><%= app.meritScore.toFixed(2) %>%</td>
                <td>
                  <span class="badge badge-<%= app.status === 'Selected' ? 'selected' : app.status === 'Not Selected' ? 'rejected' : 'pending' %>">
                    <%= app.status %>
                  </span>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <div style="text-align: center; padding: 4rem 2rem; background-color: var(--white); border-radius: 15px; margin-top: 3rem;">
        <h3 style="color: var(--grayish-blue);">No Applications Found</h3>
        <p style="color: var(--grayish-blue);">There are no applications to display.</p>
      </div>
    <% } %>
    
    <div style="text-align: center; margin-top: 2rem;">
      <a href="/admin/dashboard" class="btn btn-secondary">Back to Dashboard</a>
    </div>
  </div>
</section>

<%- include('../partials/footer') %>